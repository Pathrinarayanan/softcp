<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css/jquery.dataTables.css') }}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    {% include '_navigation.html' %}


        <form  action="/search" style="float:right;padding:15px">
            <input type="text" name="query" placeholder="Search..."  maxlength="14">
            <input class = "btn btn-success btn-sm" type="submit" value="Search" >
          </form>


    <div id="delete-modal" class="modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <p>Are you sure you want to delete this user?</p>
                </div>
                <div class="modal-footer">
                    <button id="delete-confirm" class="btn-confirm btn btn-success">Delete</button>
                    <button id="delete-cancel" class="btn-cancel btn btn-danger">Cancel</button>
                </div>
            </div>
        </div>
    </div>
      

   {% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-success">
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}
 {% endwith %}
 
    <div class="container main-table">
        <div class="page-title">
            <h1 class="">Data of All Users</h1>  <button type="button" class="btn btn-primary" onclick="home()">Insert Record</button>
            <!-- <nav><ol class="breadcrumb"><li class="breadcrumb-item"><a href="/">Home</a></li></ol></nav> -->
        </div>
        <div class="row">   
            <div class="col-md-12">
                <h5 class="heading-title">Details of members</h5>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                          <tr>
                            <th scope="col">NCRP</th>
                            <th scope="col">Type of Fraud</th>
                            <th scope="col">Date of Offence</th>
                            <th scope="col">Date of Report</th>
                            <th scope="col">Property Lost</th>
                            <th scope="col">Property Held</th>
                            <th scope="col">Property Recovered</th>
                            <th scope="col">View</th>
                            <th scope="col">Edit</th>
                            <th scope="col">Delete</th>
                          </tr>
                        </thead>
                        <tbody>
                           {% for row in data %}
                           <tr>
                                <td>{{row['ncrp']}}</td>
                                <td>{{row['type_of_fraud']}}</td>
                                <td>{{row['date_offence']}}</td>
                                <td>{{row['date_report']}}</td>
                                <td>{{row['property_lost']}}</td>
                                <td>{{row['property_held']}}</td>
                                <td>{{row['property_recovered']}}</td>
                                <td> <a href="{{ url_for('view', ncrp=row['ncrp']) }}">
                                    <i class="fa fa-eye" aria-hidden="true"></i>
                                </a> </td>
                                <td> <a href="{{ url_for('editvalues', ncrp=row['ncrp']) }}"  onclick="return confirm('Are you sure you want to edit this item?');">
                                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                </a> </td>
                                <td> 
                                    <a href="{{ url_for('deletevalues', ncrp=row['ncrp']) }}" class="delete-link">
                                        <i class="fa fa-trash-o" aria-hidden="true"></i>
                                    </a>                                        
                                 </td>
                            </tr>
                           {% endfor %}
                        </tbody>
                    </table>
            </div> 
        </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        // Get the modal element
        var modal = document.getElementById("delete-modal");

        // Get the delete link elements
        var deleteLinks = document.getElementsByClassName("delete-link");

        // Get the confirmation and cancel buttons
        var confirmBtn = document.getElementById("delete-confirm");
        var cancelBtn = document.getElementById("delete-cancel");

        function showAlert(type, message) {
            var alert = document.createElement("div");
            alert.className = "alert alert-" + type;
            alert.innerHTML = message;
            document.body.insertBefore(alert, document.body.children[1]);
            setTimeout(function() {
                alert.remove();
            }, 30000);
        }

        for (var i = 0; i < deleteLinks.length; i++) {
        deleteLinks[i].addEventListener("click", function(event) {
            event.preventDefault();
            modal.style.display = "block";
            var deleteUrl = this.getAttribute("href");
            confirmBtn.addEventListener("click", function() {
            fetch(deleteUrl, { method: "POST" })
                .then(response => {
                    if (response.ok) {
                        showAlert("success", "User deleted successfully");
                        window.scrollTo(0, 0); 
                        setInterval(function() {
                            window.location.reload();
                        }, 100);
                    } else {
                        showAlert("danger", "Something went wrong");
                    }
                })
                .catch(error => {
                console.error(error);
                });

            // Hide the modal
            modal.style.display = "none";
            });

            // Add click event listener to the cancel button
            cancelBtn.addEventListener("click", function() {
            // Hide the modal
            modal.style.display = "none";
            });
        });
        }
        

        // Close the modal if the user clicks outside of it
        window.addEventListener("click", function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
        });
        function home() {
        window.location.href = "{{ url_for('form') }}";
    }

    </script>
</body>
</html>